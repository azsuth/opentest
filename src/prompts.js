const vscode = require("vscode");

const CREATE_NEW_TEST_FILE = "Create new test file!";

function promptFileName(args) {
  const { testFileName, fileNameWithoutExtension } = args;

  return vscode.window
    .showInputBox({
      value: testFileName,
      valueSelection: [0, fileNameWithoutExtension.length],
      prompt: "Enter the name of the new test file to create"
    })
    .then(
      fileName => {
        if (fileName) {
          return { ...args, newFileName: fileName };
        }

        throw { ...args, complete: true };
      },
      () => {
        throw { ...args, complete: true };
      }
    );
}

function promptDocument(args) {
  const { files } = args;

  return vscode.window
    .showQuickPick([...files, CREATE_NEW_TEST_FILE], {
      placeHolder: "Pick a test file or create a new one?"
    })
    .then(
      selection => {
        if (selection === CREATE_NEW_TEST_FILE) {
          throw { ...args, errorCode: CREATE_NEW_TEST_FILE };
        }

        return { ...args, testFileName: selection };
      },
      () => {
        throw { ...args, complete: true };
      }
    );
}

module.exports = { promptFileName, promptDocument };
